---
- name: Verify
  hosts: molecule
  vars_files: ../../vars/main.yml
  gather_facts: true

  tasks:
    - name: Gather the package facts
      ansible.builtin.package_facts:
        manager: auto

    - name: Include RHEL verify file
      ansible.builtin.include_tasks: tasks/verify-RedHat.yml
      when:
        - ansible_facts.os_family == 'RedHat'

    - name: Fail if veracrypt-console is not installed
      ansible.builtin.fail:
        msg: "veracrypt-console package is not installed"
      when: "'veracrypt-console' not in ansible_facts.packages"
